---
title: "Fonctionnalit√©s avanc√©es"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Fonctionnalit√©s avanc√©es}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

::: {.alert .alert-info}
üá¨üáß **[English version available](advanced-features.html)** / **Version anglaise disponible**

üìñ **Voir aussi :** [Guide de d√©marrage](getting-started_FR.html) pour l'utilisation de base
:::

Cette vignette couvre les fonctionnalit√©s avanc√©es de `quartify`, notamment les options de personnalisation, le traitement par lots, les livres Quarto, l'int√©gration de la qualit√© du code et les fonctionnalit√©s sp√©ciales.

## Options de personnalisation

Vous pouvez personnaliser le document de sortie avec plusieurs param√®tres :

```{r eval=FALSE}
library(quartify)

rtoqmd(
  input_file = "mon_script.R",
  output_file = "mon_document.qmd",
  title = "Mon rapport d'analyse",
  author = "Votre nom",
  format = "html",
  theme = "cosmo",
  render_html = TRUE,
  open_html = TRUE,
  code_fold = TRUE,
  number_sections = TRUE,
  show_source_lines = TRUE
)
```

### Param√®tres disponibles

- **`input_file`** : Chemin vers votre script R
- **`output_file`** : Chemin pour le document Quarto de sortie (optionnel)
- **`title`** : Titre du document (par d√©faut : "My title")
- **`author`** : Nom de l'auteur (par d√©faut : "Your name")
- **`format`** : Format de sortie - toujours "html" (param√®tre conserv√© pour la r√©trocompatibilit√©)
- **`theme`** : Th√®me HTML Quarto (par d√©faut : "cosmo")
- **`render_html`** : Indique s'il faut g√©n√©rer le .qmd en HTML (par d√©faut : TRUE)
- **`output_html_file`** : Chemin personnalis√© pour la sortie HTML (optionnel)
- **`open_html`** : Indique s'il faut ouvrir le fichier HTML apr√®s le rendu (par d√©faut : FALSE)
- **`code_fold`** : Indique s'il faut replier les blocs de code par d√©faut (par d√©faut : FALSE)
- **`number_sections`** : Indique s'il faut num√©roter automatiquement les sections (par d√©faut : TRUE)
- **`show_source_lines`** : Afficher les num√©ros de ligne originaux dans les chunks de code (par d√©faut : TRUE)
- **`lang`** : Langue pour les √©l√©ments d'interface ("en" ou "fr", par d√©faut : "en")

### Th√®mes HTML

`quartify` supporte plus de 25 th√®mes Quarto pour la sortie HTML :

**Th√®mes clairs** : cosmo, flatly, litera, lumen, lux, materia, minty, morph, pulse, quartz, sandstone, simplex, sketchy, spacelab, united, yeti, zephyr

**Th√®mes sombres** : cyborg, darkly, slate, solar, superhero, vapor

**Mixte** : cerulean (clair-sombre)

Essayez diff√©rents th√®mes pour trouver le look parfait :

```{r eval=FALSE}
# Moderne et √©pur√©
rtoqmd("script.R", theme = "cosmo")

# Mode sombre
rtoqmd("script.R", theme = "darkly")

# Style acad√©mique
rtoqmd("script.R", theme = "litera")
```

## Conversion par lots de r√©pertoires

### Utilisation de rtoqmd_dir()

Convertissez tous les scripts R d'un r√©pertoire (y compris les sous-r√©pertoires) par programmation :

```{r eval=FALSE}
# Convertir tous les scripts R d'un r√©pertoire
rtoqmd_dir("chemin/vers/scripts")

# Convertir et g√©n√©rer en HTML
rtoqmd_dir("chemin/vers/scripts", render_html = TRUE)

# Avec auteur personnalis√© et pr√©fixe de titre
rtoqmd_dir("chemin/vers/scripts", 
           author = "Votre nom",
           title_prefix = "Projet : ")
```

### Via l'interface Shiny

1. **Lancez l'addin RStudio** ou `quartify_app()`
2. **S√©lectionnez le mode "R√©pertoire"** dans l'interface
3. **Choisissez le r√©pertoire** contenant vos scripts R
4. **Configurez les options** (auteur, th√®me, etc.)
5. **Cliquez sur GENERATE**

Tous les fichiers `.R` seront convertis en fichiers `.qmd` correspondants dans la m√™me structure de r√©pertoires.

## Cr√©ation de livres Quarto

`quartify` peut cr√©er automatiquement un livre Quarto √† partir d'un r√©pertoire de scripts R, en g√©n√©rant un fichier `_quarto.yml` avec table des mati√®res.

### M√©thode 1 : Via l'interface Shiny

1. Lancez l'addin ou `quartify_app()`
2. S√©lectionnez le mode "R√©pertoire"
3. Choisissez votre r√©pertoire de scripts
4. **Cochez "Cr√©er un livre Quarto"**
5. Cliquez sur GENERATE

### M√©thode 2 : Par programmation

```{r eval=FALSE}
# Cr√©er un livre Quarto avec table des mati√®res
rtoqmd_dir(
  dir_path = "chemin/vers/scripts",
  create_book = TRUE,
  output_dir = "_book",  # R√©pertoire de sortie
  render_html = TRUE,
  author = "Votre nom"
)
```

### Structure du livre

Le livre g√©n√©r√© inclut :

- **`_quarto.yml`** : Configuration du livre avec table des mati√®res automatique
- **`index.qmd`** : Page d'accueil du livre
- **Fichiers `.qmd`** : Un pour chaque script R, organis√©s par structure de r√©pertoires
- **Rendu HTML** : Si `render_html = TRUE`, g√©n√®re le site web complet

La table des mati√®res respecte votre structure de r√©pertoires et inclut des sections pour chaque sous-r√©pertoire.

## Int√©gration de la qualit√© du code

`quartify` s'int√®gre avec `styler` et `lintr` pour aider √† am√©liorer la qualit√© de votre code R. Cette fonctionnalit√© vous permet de :

- **Visualiser les probl√®mes de style** avec des onglets comparant le code original et stylis√©
- **Voir les probl√®mes de qualit√©** d√©tect√©s par lintr
- **Appliquer automatiquement le formatage** √† vos fichiers source

### Installation

Les packages de qualit√© du code sont optionnels. Installez-les uniquement si vous souhaitez utiliser ces fonctionnalit√©s :

```{r eval=FALSE}
# Pour le formatage du code
install.packages("styler")

# Pour les v√©rifications de qualit√©
install.packages("lintr")

# Les deux
install.packages(c("styler", "lintr"))
```

### Utilisation de base

#### Via l'interface Shiny (addin ou app)

1. **Lancez l'interface** : Utilisez l'addin RStudio ou `quartify_app()`
2. **S√©lectionnez votre script** : Choisissez le fichier R √† convertir
3. **Activez les v√©rifications de qualit√©** :
   - ‚òëÔ∏è **Use styler** : Affiche une version format√©e dans des onglets
   - ‚òëÔ∏è **Use lintr** : Affiche les probl√®mes de qualit√© dans des onglets
   - ‚òëÔ∏è **Apply styler** : Modifie le fichier R original avec le formatage styler
4. **Cliquez sur GENERATE**

#### Par programmation

```{r eval=FALSE}
library(quartify)

# Avec v√©rifications styler et lintr (affiche les onglets)
rtoqmd(
  input_file = "mon_script.R",
  use_styler = TRUE,
  use_lintr = TRUE
)

# Appliquer styler au fichier source (modifie l'original)
rtoqmd(
  input_file = "mon_script.R",
  use_styler = TRUE,
  apply_styler = TRUE  # ATTENTION : Modifie le fichier R !
)
```

### Fonctionnement

Lorsque les v√©rifications de qualit√© du code sont activ√©es :

#### 1. Mode styler (use_styler = TRUE)

Cr√©e des onglets dans le document Quarto :

```markdown
::: {.panel-tabset}
## Original Code
```r
# Votre code non format√©
x=3;y<-5
```

## Styled Code
```r
# Code format√© par styler
x <- 3
y <- 5
```
:::
```

#### 2. Mode lintr (use_lintr = TRUE)

Ajoute une section avec les probl√®mes d√©tect√©s :

```markdown
::: {.callout-warning collapse="true"}
## Code Quality Issues

- Line 5: Use <-, not =, for assignment
- Line 12: Lines should not be more than 80 characters
- Line 23: Variable names should use snake_case
:::
```

#### 3. Mode apply_styler (apply_styler = TRUE)

‚ö†Ô∏è **IMPORTANT** : Ce mode **modifie votre fichier R original**.

- Le fichier source est reformat√© avec les r√®gles de styler
- Les onglets comparatifs ne sont PAS affich√©s (le code est d√©j√† stylis√©)
- **Recommandation** : Utilisez le contr√¥le de version (git) avant d'utiliser cette option

### Exemple de d√©monstration

Essayez avec le fichier d'exemple fourni :

```{r eval=FALSE}
# Obtenir le chemin du fichier d'exemple
example_file <- system.file("examples", "example_code_quality.R", 
                           package = "quartify")

# Convertir avec v√©rifications de qualit√©
rtoqmd(
  input_file = example_file,
  output_file = "example_with_quality.qmd",
  use_styler = TRUE,
  use_lintr = TRUE,
  render_html = TRUE,
  open_html = TRUE
)
```

Le document HTML g√©n√©r√© affichera :
- Des onglets montrant le code original vs stylis√©
- Une section avertissement avec les probl√®mes de qualit√© d√©tect√©s
- Tout cela dans un format propre et navigable

### Avantages

1. **Am√©lioration de la qualit√© du code** :
   - Identifie automatiquement les probl√®mes de style
   - Sugg√®re les meilleures pratiques
   - Aide √† maintenir la coh√©rence

2. **Documentation p√©dagogique** :
   - Montre les diff√©rences avant/apr√®s
   - Explique les probl√®mes de qualit√©
   - Utile pour l'enseignement et la r√©vision de code

3. **Int√©gration transparente** :
   - Fonctionne avec votre workflow existant
   - G√©n√©ration de documentation automatique
   - Aucune configuration suppl√©mentaire n√©cessaire

### Configuration

Les v√©rifications de qualit√© utilisent les configurations par d√©faut de styler et lintr. Pour personnaliser :

#### Styler

Cr√©ez un fichier `.Rprofile` dans votre projet :

```{r eval=FALSE}
# .Rprofile
options(
  styler.addins_style_transformer = "styler::tidyverse_style()"
)
```

#### Lintr

Cr√©ez un fichier `.lintr` dans votre projet :

```
linters: with_defaults(
  line_length_linter(120),
  object_name_linter = NULL
)
```

### D√©pannage

**Probl√®me** : "styler package not found"
**Solution** : Installez styler avec `install.packages("styler")`

**Probl√®me** : "lintr package not found"
**Solution** : Installez lintr avec `install.packages("lintr")`

**Probl√®me** : apply_styler ne modifie pas le fichier
**Solution** : V√©rifiez les permissions du fichier et que le fichier n'est pas en lecture seule

**Probl√®me** : Trop de probl√®mes lintr affich√©s
**Solution** : Personnalisez votre configuration `.lintr` pour d√©sactiver les linters sp√©cifiques

## Fonctionnalit√©s sp√©ciales

### Diagrammes Mermaid

Cr√©ez des diagrammes de flux directement dans vos scripts R en utilisant des blocs de commentaires :

```{r eval=FALSE}
#| Diagramme de processus
#|
#| ```{mermaid}
#| flowchart LR
#|   A[Donn√©es brutes] --> B[Nettoyage]
#|   B --> C[Analyse]
#|   C --> D[Visualisation]
#|   D --> E[Rapport]
#| ```
```

Apr√®s conversion, cela g√©n√®re un vrai diagramme Mermaid dans votre document Quarto.

### Callouts (Encarts)

Cr√©ez des bo√Ætes d'information, d'avertissement ou de note :

```{r eval=FALSE}
#| ::: {.callout-note}
#| Ceci est une note importante
#| :::

#| ::: {.callout-warning}
#| Attention : ceci peut prendre du temps
#| :::

#| ::: {.callout-tip}
#| Astuce : utilisez la mise en cache pour de meilleurs performances
#| :::
```

Types disponibles : `note`, `warning`, `important`, `tip`, `caution`

### Snippets de code inline

Incluez de petits extraits de code R inline dans vos commentaires :

```{r eval=FALSE}
#| Le dataset contient `r nrow(data)` observations.
```

Cela sera √©valu√© et le r√©sultat sera ins√©r√© dans le texte.

## Conseils et bonnes pratiques

### Organisation des scripts

1. **Commencez par des m√©tadonn√©es** :
```{r eval=FALSE}
#' ---
#' title: "Mon analyse"
#' author: "Votre nom"
#' date: "`r Sys.Date()`"
#' ---
```

2. **Utilisez des sections claires** :
```{r eval=FALSE}
#' # Section principale
#'
#' ## Sous-section
```

3. **Commentez abondamment** :
```{r eval=FALSE}
#' Cette fonction calcule...
#' 
#' @param x Un vecteur num√©rique
#' @return La moyenne de x
ma_fonction <- function(x) {
  mean(x, na.rm = TRUE)
}
```

### Workflow recommand√©

1. **√âcrivez votre analyse** dans un script R normal
2. **Ajoutez des commentaires** pour documenter votre pens√©e
3. **Utilisez des sections** pour organiser le contenu
4. **Convertissez avec quartify** quand vous √™tes pr√™t
5. **Affinez** le document Quarto si n√©cessaire
6. **Partagez** le HTML r√©sultant

### Pour les projets plus larges

- Utilisez le **mode r√©pertoire** pour traiter plusieurs scripts
- Cr√©ez un **livre Quarto** pour une navigation int√©gr√©e
- Utilisez **Git** pour le contr√¥le de version
- Activez les **v√©rifications de qualit√© du code** pour maintenir la coh√©rence

### Optimisation des performances

Pour les scripts volumineux :

```{r eval=FALSE}
# D√©sactivez le rendu pendant le d√©veloppement
rtoqmd("script.R", render_html = FALSE)

# Activez la mise en cache Quarto dans vos scripts
#| cache: true

# Utilisez code_fold pour masquer les longs blocs de code
rtoqmd("script.R", code_fold = TRUE)
```

## Ressources suppl√©mentaires

- **Documentation Quarto** : <https://quarto.org/>
- **Guide styler** : <https://styler.r-lib.org/>
- **Documentation lintr** : <https://lintr.r-lib.org/>
- **R√©f√©rence Mermaid** : <https://mermaid.js.org/>

## Obtenir de l'aide

Si vous rencontrez des probl√®mes :

1. **V√©rifiez la documentation** : Commencez par le [guide de d√©marrage](getting-started_FR.html)
2. **Issues GitHub** : <https://github.com/ddotta/quartify/issues>
3. **Exemples** : Utilisez `system.file("examples", package = "quartify")`

---

::: {.alert .alert-success}
üí° **Astuce** : Toutes ces fonctionnalit√©s sont accessibles √† la fois via l'interface Shiny et par programmation. Choisissez la m√©thode qui convient le mieux √† votre workflow !
:::
